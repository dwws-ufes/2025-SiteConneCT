<!-- templates/activities/detail.html -->
{% extends "base.html" %}

{% block content %}
<div class="activity-detail">
    <h2>{{ activity.nome }}</h2>
    
    <div class="activity-info">
        <p><strong>Descrição:</strong> {{ activity.descricao or 'Nenhuma descrição disponível' }}</p>
        <p><strong>Data:</strong> {{ activity.data.strftime('%d/%m/%Y') }}</p>
        
        {% if activity.horario %}
        <p><strong>Horário:</strong> 
            {% if activity.horario is string %}
                {{ activity.horario }}
            {% else %}
                {{ activity.horario.strftime('%H:%M') }}
            {% endif %}
        </p>
        {% endif %}
        
        {% if activity.local %}
        <p><strong>Local:</strong> {{ activity.local }}</p>
        {% endif %}
        
        <p><strong>Vagas disponíveis:</strong> {{ activity.vagas_disponiveis }}</p>
        <p><strong>Status:</strong> {{ activity.status.value if activity.status else activity.situacao.value }}</p>
    </div>

    <!-- Seção de informações da DBpedia -->
    <div id="dbpedia-info" class="dbpedia-section" style="display: none;">
        <h3>Informações do Tema (DBpedia)</h3>
        <div id="dbpedia-content"></div>
    </div>

    <div class="activity-actions">
        {% if current_user.is_authenticated %}
            {% if activity in current_user.[activity_type ~ 's_inscritos'] %}
                <form action="{{ url_for('user.cancelar_inscricao_' ~ activity_type, activity_id=activity.id) }}" method="POST">
                    <button type="submit" class="btn btn-danger">Cancelar Inscrição</button>
                </form>
            {% else %}
                <form action="{{ url_for('user.inscrever_' ~ activity_type, activity_id=activity.id) }}" method="POST">
                    <button type="submit" class="btn btn-primary">Inscrever-se</button>
                </form>
            {% endif %}
        {% endif %}
        
        <button id="load-dbpedia" class="btn btn-info">Carregar informações da DBpedia</button>
        <a href="{{ url_for('semantic.activity_rdf', activity_type=activity_type, activity_id=activity.id) }}" 
           class="btn btn-secondary" download>Baixar dados RDF</a>
    </div>
</div>

<script>
document.getElementById('load-dbpedia').addEventListener('click', function() {
    fetch('{{ url_for("semantic.activity_dbpedia_info", activity_type=activity_type, activity_id=activity.id) }}')
        .then(response => response.json())
        .then(data => {
            const dbpediaSection = document.getElementById('dbpedia-info');
            const dbpediaContent = document.getElementById('dbpedia-content');
            
            if (data.abstract) {
                dbpediaContent.innerHTML = `
                    <p>${data.abstract}</p>
                    ${data.thumbnail ? `<img src="${data.thumbnail}" alt="Imagem do tema" style="max-width: 300px;">` : ''}
                    <p><small>Fonte: <a href="${data.dbpedia_uri || 'http://dbpedia.org'}" target="_blank">DBpedia</a></small></p>
                `;
                dbpediaSection.style.display = 'block';
            } else {
                dbpediaContent.innerHTML = '<p>Nenhuma informação encontrada na DBpedia para este tema.</p>';
                dbpediaSection.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Erro ao carregar informações da DBpedia:', error);
            alert('Erro ao carregar informações da DBpedia.');
        });
});
</script>
{% endblock %}